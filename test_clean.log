=== STRESS TESTS WORKFLOW STARTED ===
Stress Tests Configuration:
  SIMULATOR_NUM_MESSAGES: 1000
  MAX_ALLOWED_TIME_MS: 30000
Installing .NET Aspire Workload...

Workload(s) 'aspire' are already installed.
Skipping NuGet package signature verification.
Skipping NuGet package signature verification.
Skipping NuGet package signature verification.
Skipping NuGet package signature verification.
Skipping NuGet package signature verification.
Installing pack Aspire.Hosting.Sdk version 8.2.2...
Pack Aspire.Hosting.Sdk version 8.2.2 is already installed.
Writing workload pack installation record for Aspire.Hosting.Sdk version 8.2.2...
Installing pack Aspire.ProjectTemplates version 8.2.2...
Pack Aspire.ProjectTemplates version 8.2.2 is already installed.
Writing workload pack installation record for Aspire.ProjectTemplates version 8.2.2...
Garbage collecting for SDK feature band(s) 8.0.100...

Successfully installed workload(s) aspire.

Installing workloads: 

Skipping NuGet package signature verification.
Skipping NuGet package signature verification.
Installing pack Aspire.Hosting.Sdk version 8.2.2...
Pack Aspire.Hosting.Sdk version 8.2.2 is already installed.
Writing workload pack installation record for Aspire.Hosting.Sdk version 8.2.2...
Installing pack Aspire.ProjectTemplates version 8.2.2...
Pack Aspire.ProjectTemplates version 8.2.2 is already installed.
Writing workload pack installation record for Aspire.ProjectTemplates version 8.2.2...
Garbage collecting for SDK feature band(s) 8.0.100...

Successfully installed workload(s) aspire.

Installing workloads: 

Skipping NuGet package signature verification.
Skipping NuGet package signature verification.
Skipping NuGet package signature verification.
Installing pack Aspire.Hosting.Sdk version 8.2.2...
Pack Aspire.Hosting.Sdk version 8.2.2 is already installed.
Writing workload pack installation record for Aspire.Hosting.Sdk version 8.2.2...
Installing pack Aspire.ProjectTemplates version 8.2.2...
Pack Aspire.ProjectTemplates version 8.2.2 is already installed.
Writing workload pack installation record for Aspire.ProjectTemplates version 8.2.2...
Garbage collecting for SDK feature band(s) 8.0.100...

Successfully installed workload(s) aspire.

Installing workloads: 

Skipping NuGet package signature verification.
Skipping NuGet package signature verification.
Skipping NuGet package signature verification.
Installing pack Aspire.Hosting.Sdk version 8.2.2...
Pack Aspire.Hosting.Sdk version 8.2.2 is already installed.
Writing workload pack installation record for Aspire.Hosting.Sdk version 8.2.2...
Installing pack Aspire.ProjectTemplates version 8.2.2...
Pack Aspire.ProjectTemplates version 8.2.2 is already installed.
Writing workload pack installation record for Aspire.ProjectTemplates version 8.2.2...
Garbage collecting for SDK feature band(s) 8.0.100...

Successfully installed workload(s) aspire.

Building FlinkDotNet solution...
MSBuild version 17.8.27+3ab07f0cf for .NET
  Determining projects to restore...
  All projects are up-to-date for restore.
  FlinkDotNet.Core.Abstractions -> /home/runner/work/FLINK.NET/FLINK.NET/FlinkDotNet/FlinkDotNet.Core.Abstractions/bin/Release/net8.0/FlinkDotNet.Core.Abstractions.dll
  FlinkDotNet.Storage.FileSystem -> /home/runner/work/FLINK.NET/FLINK.NET/FlinkDotNet/FlinkDotNet.Storage.FileSystem/bin/Release/net8.0/FlinkDotNet.Storage.FileSystem.dll
  FlinkDotNet.Connectors.Sources.File -> /home/runner/work/FLINK.NET/FLINK.NET/FlinkDotNet/FlinkDotNet.Connectors.Sources.File/bin/Release/net8.0/FlinkDotNet.Connectors.Sources.File.dll
  FlinkDotNet.Connectors.Sinks.Console -> /home/runner/work/FLINK.NET/FLINK.NET/FlinkDotNet/FlinkDotNet.Connectors.Sinks.Console/bin/Release/net8.0/FlinkDotNet.Connectors.Sinks.Console.dll
  FlinkDotNet.Connectors.Sources.Kafka -> /home/runner/work/FLINK.NET/FLINK.NET/FlinkDotNet/FlinkDotNet.Connectors.Sources.Kafka/bin/Release/net8.0/FlinkDotNet.Connectors.Sources.Kafka.dll
  FlinkDotNet.Connectors.Sinks.Console.Tests -> /home/runner/work/FLINK.NET/FLINK.NET/FlinkDotNet/FlinkDotNet.Connectors.Sinks.Console.Tests/bin/Release/net8.0/FlinkDotNet.Connectors.Sinks.Console.Tests.dll
  FlinkDotNet.Core -> /home/runner/work/FLINK.NET/FLINK.NET/FlinkDotNet/FlinkDotNet.Core/bin/Release/net8.0/FlinkDotNet.Core.dll
  FlinkDotNet.Connectors.Sources.File.Tests -> /home/runner/work/FLINK.NET/FLINK.NET/FlinkDotNet/FlinkDotNet.Connectors.Sources.File.Tests/bin/Release/net8.0/FlinkDotNet.Connectors.Sources.File.Tests.dll
  FlinkDotNet.Common.Constants -> /home/runner/work/FLINK.NET/FLINK.NET/FlinkDotNet/FlinkDotNet.Common.Constants/bin/Release/net8.0/FlinkDotNet.Common.Constants.dll
  FlinkDotNet.Storage.FileSystem.Tests -> /home/runner/work/FLINK.NET/FLINK.NET/FlinkDotNet/FlinkDotNet.Storage.FileSystem.Tests/bin/Release/net8.0/FlinkDotNet.Storage.FileSystem.Tests.dll
  FlinkDotNet.Common.Constants.Tests -> /home/runner/work/FLINK.NET/FLINK.NET/FlinkDotNet/FlinkDotNet.Common.Constants.Tests/bin/Release/net8.0/FlinkDotNet.Common.Constants.Tests.dll
  FlinkDotNet.Storage.RocksDB -> /home/runner/work/FLINK.NET/FLINK.NET/FlinkDotNet/FlinkDotNet.Storage.RocksDB/bin/Debug/net8.0/FlinkDotNet.Storage.RocksDB.dll
  FlinkDotNet.Core.Tests -> /home/runner/work/FLINK.NET/FLINK.NET/FlinkDotNet/FlinkDotNet.Core.Tests/bin/Release/net8.0/FlinkDotNet.Core.Tests.dll
  FlinkDotNet.JobManager -> /home/runner/work/FLINK.NET/FLINK.NET/FlinkDotNet/FlinkDotNet.JobManager/bin/Release/net8.0/FlinkDotNet.JobManager.dll
  FlinkDotNet.Core.Api -> /home/runner/work/FLINK.NET/FLINK.NET/FlinkDotNet/FlinkDotNet.Core.Api/bin/Release/net8.0/FlinkDotNet.Core.Api.dll
  FlinkDotNet.Table.Api -> /home/runner/work/FLINK.NET/FLINK.NET/FlinkDotNet/FlinkDotNet.Table.Api/bin/Release/net8.0/FlinkDotNet.Table.Api.dll
  FlinkDotNet.JobManager.Tests -> /home/runner/work/FLINK.NET/FLINK.NET/FlinkDotNet/FlinkDotNet.JobManager.Tests/bin/Release/net8.0/FlinkDotNet.JobManager.Tests.dll
  FlinkDotNet.TaskManager -> /home/runner/work/FLINK.NET/FLINK.NET/FlinkDotNet/FlinkDotNet.TaskManager/bin/Release/net8.0/FlinkDotNet.TaskManager.dll
  FlinkDotNet.Architecture.Tests -> /home/runner/work/FLINK.NET/FLINK.NET/FlinkDotNet/FlinkDotNet.Architecture.Tests/bin/Release/net8.0/FlinkDotNet.Architecture.Tests.dll

Build succeeded.
    0 Warning(s)
    0 Error(s)

Time Elapsed 00:00:19.77
Building FlinkDotNetAspire solution...
MSBuild version 17.8.27+3ab07f0cf for .NET
  Determining projects to restore...
  All projects are up-to-date for restore.
  FlinkDotNetAspire.AppHost.ServiceDefaults -> /home/runner/work/FLINK.NET/FLINK.NET/FlinkDotNetAspire/FlinkDotNetAspire.AppHost.ServiceDefaults/bin/Release/net8.0/FlinkDotNetAspire.AppHost.ServiceDefaults.dll
  FlinkDotNet.Common.Constants -> /home/runner/work/FLINK.NET/FLINK.NET/FlinkDotNet/FlinkDotNet.Common.Constants/bin/Debug/net8.0/FlinkDotNet.Common.Constants.dll
  IntegrationTestVerifier -> /home/runner/work/FLINK.NET/FLINK.NET/FlinkDotNetAspire/IntegrationTestVerifier/bin/Release/net8.0/FlinkDotNet.IntegrationTestVerifier.dll
  FlinkDotNet.Core.Abstractions -> /home/runner/work/FLINK.NET/FLINK.NET/FlinkDotNet/FlinkDotNet.Core.Abstractions/bin/Debug/net8.0/FlinkDotNet.Core.Abstractions.dll
  FlinkDotNet.Storage.RocksDB -> /home/runner/work/FLINK.NET/FLINK.NET/FlinkDotNet/FlinkDotNet.Storage.RocksDB/bin/Debug/net8.0/FlinkDotNet.Storage.RocksDB.dll
  FlinkDotNet.JobManager -> /home/runner/work/FLINK.NET/FLINK.NET/FlinkDotNet/FlinkDotNet.JobManager/bin/Release/net8.0/FlinkDotNet.JobManager.dll
  FlinkDotNet.Connectors.Sinks.Console -> /home/runner/work/FLINK.NET/FLINK.NET/FlinkDotNet/FlinkDotNet.Connectors.Sinks.Console/bin/Debug/net8.0/FlinkDotNet.Connectors.Sinks.Console.dll
  FlinkDotNet.Connectors.Sources.File -> /home/runner/work/FLINK.NET/FLINK.NET/FlinkDotNet/FlinkDotNet.Connectors.Sources.File/bin/Debug/net8.0/FlinkDotNet.Connectors.Sources.File.dll
  FlinkDotNet.Core -> /home/runner/work/FLINK.NET/FLINK.NET/FlinkDotNet/FlinkDotNet.Core/bin/Debug/net8.0/FlinkDotNet.Core.dll
  FlinkDotNet.Storage.FileSystem -> /home/runner/work/FLINK.NET/FLINK.NET/FlinkDotNet/FlinkDotNet.Storage.FileSystem/bin/Debug/net8.0/FlinkDotNet.Storage.FileSystem.dll
  FlinkDotNet.Core.Api -> /home/runner/work/FLINK.NET/FLINK.NET/FlinkDotNet/FlinkDotNet.Core.Api/bin/Debug/net8.0/FlinkDotNet.Core.Api.dll
  FlinkJobSimulator -> /home/runner/work/FLINK.NET/FLINK.NET/FlinkDotNetAspire/FlinkJobSimulator/bin/Release/net8.0/FlinkJobSimulator.dll
  FlinkDotNet.TaskManager -> /home/runner/work/FLINK.NET/FLINK.NET/FlinkDotNet/FlinkDotNet.TaskManager/bin/Release/net8.0/FlinkDotNet.TaskManager.dll
  FlinkDotNetAspire.AppHost.AppHost -> /home/runner/work/FLINK.NET/FLINK.NET/FlinkDotNetAspire/FlinkDotNetAspire.AppHost.AppHost/bin/Release/net8.0/FlinkDotNetAspire.AppHost.AppHost.dll
  FlinkDotNetAspire.IntegrationTests -> /home/runner/work/FLINK.NET/FLINK.NET/FlinkDotNetAspire/FlinkDotNetAspire.IntegrationTests/bin/Release/net8.0/FlinkDotNetAspire.IntegrationTests.dll

Build succeeded.
    0 Warning(s)
    0 Error(s)

Time Elapsed 00:00:10.88
Starting Aspire AppHost...
Started AppHost with PID: 19253
Waiting 60 seconds for Redis/Kafka container initialization...
Discovering actual Aspire container ports...
=== Discovering Aspire Container Ports ===
Current Docker containers:
NAMES     IMAGE     PORTS
No exact Redis ancestor matches, checking all containers for Redis...
No Redis containers found
No exact Kafka ancestor matches, checking all containers for Kafka...
No Kafka containers found

=== Discovery Results ===
‚ùå Redis connection info not discovered
1
Starting health checks...
Health check attempt 1/5
=== FlinkDotNet Integration Test Verifier Started ===
Started at: 2025-06-13 21:06:02 UTC
Arguments: --health-check

=== Environment Variables ===
DOTNET_REDIS_URL: <not set>
DOTNET_KAFKA_BOOTSTRAP_SERVERS: <not set>
SIMULATOR_NUM_MESSAGES: 1000
SIMULATOR_REDIS_KEY_GLOBAL_SEQUENCE: <not set>
SIMULATOR_REDIS_KEY_SINK_COUNTER: <not set>
SIMULATOR_KAFKA_TOPIC: <not set>
MAX_ALLOWED_TIME_MS: 30000
DOTNET_ENVIRONMENT: <not set>

=== Running in --health-check mode ===

üè• === INFRASTRUCTURE HEALTH CHECK ===
üìã Validating Redis and Kafka container accessibility

üîç DISCOVERY: Resolving service connection strings
   ‚ö† Redis connection string not found in env. Using default: localhost:6379
   ‚ö† Kafka bootstrap servers not found in env. Using default: localhost:9092

   üîå Testing Redis port reachability (localhost:6379)...
      ‚ùå Port unreachable
   üîå Testing Kafka port reachability (localhost:9092)...
      ‚ùå Port unreachable

üî¥ HEALTH CHECK 1: Redis Service
   üìå GIVEN: Redis container should be accessible at localhost:6379
   üéØ WHEN: Attempting connection and basic operations
WaitForRedisAsync: connectionString='localhost:6379', maxAttempts=2, delaySeconds=5
Redis attempt 1/2: Connecting to localhost:6379
‚ùå Redis connection established but not connected (took 15085ms)
Waiting 5 seconds before next Redis attempt...
Redis attempt 2/2: Connecting to localhost:6379
‚ùå Redis connection established but not connected (took 2ms)
‚ùå Redis connection failed after 2 attempts
   ‚ùå THEN: Redis health check FAILED (took 20097ms)

üü° HEALTH CHECK 2: Kafka Service
   üìå GIVEN: Kafka container should be accessible at localhost:9092
   üéØ WHEN: Attempting connection and metadata retrieval
      üîç Testing Kafka connectivity: bootstrapServers='localhost:9092', maxAttempts=2, delaySeconds=5
      üîß Fixed IPv6 issue: Using 127.0.0.1:9092 instead of localhost:9092
      ‚è≥ Kafka attempt 1/2: Connecting to 127.0.0.1:9092
%3|1749848782.794|FAIL|rdkafka#producer-1| [thrd:127.0.0.1:9092/bootstrap]: 127.0.0.1:9092/bootstrap: Connect to ipv4#127.0.0.1:9092 failed: Connection refused (after 0ms in state CONNECT)
%3|1749848782.794|ERROR|rdkafka#producer-1| [thrd:127.0.0.1:9092/bootstrap]: 1/1 brokers are down
%3|1749848782.795|ERROR|rdkafka#producer-1| [thrd:app]: rdkafka#producer-1: 127.0.0.1:9092/bootstrap: Connect to ipv4#127.0.0.1:9092 failed: Connection refused (after 0ms in state CONNECT)
%3|1749848782.846|FAIL|rdkafka#producer-1| [thrd:127.0.0.1:9092/bootstrap]: 127.0.0.1:9092/bootstrap: Connect to ipv4#127.0.0.1:9092 failed: Connection refused (after 0ms in state CONNECT, 1 identical error(s) suppressed)
%3|1749848782.846|ERROR|rdkafka#producer-1| [thrd:app]: rdkafka#producer-1: 127.0.0.1:9092/bootstrap: Connect to ipv4#127.0.0.1:9092 failed: Connection refused (after 0ms in state CONNECT, 1 identical error(s) suppressed)
      ‚ùå Kafka connection failed: KafkaException: Local: Broker transport failure
      ‚è≥ Waiting 5 seconds before next Kafka attempt...
      ‚è≥ Kafka attempt 2/2: Connecting to 127.0.0.1:9092
%3|1749848797.856|FAIL|rdkafka#producer-2| [thrd:127.0.0.1:9092/bootstrap]: 127.0.0.1:9092/bootstrap: Connect to ipv4#127.0.0.1:9092 failed: Connection refused (after 0ms in state CONNECT)
%3|1749848797.856|ERROR|rdkafka#producer-2| [thrd:127.0.0.1:9092/bootstrap]: 1/1 brokers are down
%3|1749848797.856|ERROR|rdkafka#producer-2| [thrd:app]: rdkafka#producer-2: 127.0.0.1:9092/bootstrap: Connect to ipv4#127.0.0.1:9092 failed: Connection refused (after 0ms in state CONNECT)
%3|1749848797.907|FAIL|rdkafka#producer-2| [thrd:127.0.0.1:9092/bootstrap]: 127.0.0.1:9092/bootstrap: Connect to ipv4#127.0.0.1:9092 failed: Connection refused (after 0ms in state CONNECT, 1 identical error(s) suppressed)
%3|1749848797.907|ERROR|rdkafka#producer-2| [thrd:app]: rdkafka#producer-2: 127.0.0.1:9092/bootstrap: Connect to ipv4#127.0.0.1:9092 failed: Connection refused (after 0ms in state CONNECT, 1 identical error(s) suppressed)
      ‚ùå Kafka connection failed: KafkaException: Local: Broker transport failure
      ‚ùå Kafka connection failed after 2 attempts
   ‚ùå THEN: Kafka health check FAILED (took 25187ms)

üèÅ === HEALTH CHECK SUMMARY ===
üí• INFRASTRUCTURE: ‚ùå **UNHEALTHY** - Service failures detected
   ‚ùå Redis: Failed
   ‚ùå Kafka: Failed
‚ùå Health check FAILED on attempt 1
Waiting 10 seconds before retry...
Health check attempt 2/5
=== FlinkDotNet Integration Test Verifier Started ===
Started at: 2025-06-13 21:06:57 UTC
Arguments: --health-check

=== Environment Variables ===
DOTNET_REDIS_URL: <not set>
DOTNET_KAFKA_BOOTSTRAP_SERVERS: <not set>
SIMULATOR_NUM_MESSAGES: 1000
SIMULATOR_REDIS_KEY_GLOBAL_SEQUENCE: <not set>
SIMULATOR_REDIS_KEY_SINK_COUNTER: <not set>
SIMULATOR_KAFKA_TOPIC: <not set>
MAX_ALLOWED_TIME_MS: 30000
DOTNET_ENVIRONMENT: <not set>

=== Running in --health-check mode ===

üè• === INFRASTRUCTURE HEALTH CHECK ===
üìã Validating Redis and Kafka container accessibility

üîç DISCOVERY: Resolving service connection strings
   ‚ö† Redis connection string not found in env. Using default: localhost:6379
   ‚ö† Kafka bootstrap servers not found in env. Using default: localhost:9092

   üîå Testing Redis port reachability (localhost:6379)...
      ‚ùå Port unreachable
   üîå Testing Kafka port reachability (localhost:9092)...
      ‚ùå Port unreachable

üî¥ HEALTH CHECK 1: Redis Service
   üìå GIVEN: Redis container should be accessible at localhost:6379
   üéØ WHEN: Attempting connection and basic operations
WaitForRedisAsync: connectionString='localhost:6379', maxAttempts=2, delaySeconds=5
Redis attempt 1/2: Connecting to localhost:6379
‚ùå Redis connection established but not connected (took 15081ms)
Waiting 5 seconds before next Redis attempt...
Redis attempt 2/2: Connecting to localhost:6379
‚ùå Redis connection established but not connected (took 2ms)
‚ùå Redis connection failed after 2 attempts
   ‚ùå THEN: Redis health check FAILED (took 20092ms)

üü° HEALTH CHECK 2: Kafka Service
   üìå GIVEN: Kafka container should be accessible at localhost:9092
   üéØ WHEN: Attempting connection and metadata retrieval
      üîç Testing Kafka connectivity: bootstrapServers='localhost:9092', maxAttempts=2, delaySeconds=5
      üîß Fixed IPv6 issue: Using 127.0.0.1:9092 instead of localhost:9092
      ‚è≥ Kafka attempt 1/2: Connecting to 127.0.0.1:9092
%3|1749848838.188|FAIL|rdkafka#producer-1| [thrd:127.0.0.1:9092/bootstrap]: 127.0.0.1:9092/bootstrap: Connect to ipv4#127.0.0.1:9092 failed: Connection refused (after 0ms in state CONNECT)
%3|1749848838.188|ERROR|rdkafka#producer-1| [thrd:127.0.0.1:9092/bootstrap]: 1/1 brokers are down
%3|1749848838.189|ERROR|rdkafka#producer-1| [thrd:app]: rdkafka#producer-1: 127.0.0.1:9092/bootstrap: Connect to ipv4#127.0.0.1:9092 failed: Connection refused (after 0ms in state CONNECT)
%3|1749848838.239|FAIL|rdkafka#producer-1| [thrd:127.0.0.1:9092/bootstrap]: 127.0.0.1:9092/bootstrap: Connect to ipv4#127.0.0.1:9092 failed: Connection refused (after 0ms in state CONNECT, 1 identical error(s) suppressed)
%3|1749848838.240|ERROR|rdkafka#producer-1| [thrd:app]: rdkafka#producer-1: 127.0.0.1:9092/bootstrap: Connect to ipv4#127.0.0.1:9092 failed: Connection refused (after 0ms in state CONNECT, 1 identical error(s) suppressed)
